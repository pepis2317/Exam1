CREATE TABLE Categories(
categoryId varchar(50) primary key,
categoryName varchar(255) not null
);
CREATE TABLE Users (
userId UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
userName VARCHAR(255) UNIQUE NOT NULL,
email VARCHAR(255) UNIQUE NOT NULL,
password VARCHAR(255) NOT NULL,
role VARCHAR(50) NOT NULL DEFAULT 'user' 
);
CREATE TABLE Tickets(
ticketCode VARCHAR(50) PRIMARY KEY,
ticketName VARCHAR(255) NOT NULL,
categoryId VARCHAR(50) NOT NULL,
price INT NOT NULL,
quota INT NOT NULL,
eventDate DATETIME DEFAULT GETDATE(),
FOREIGN KEY(categoryId) REFERENCES Categories(categoryId) ON DELETE CASCADE,
);
CREATE TABLE Carts(
cartId UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
userId UNIQUEIDENTIFIER NOT NULL,
bookedTicketId VARCHAR(50) NOT NULL,
isCompleted VARCHAR(50) NOT NULL DEFAULT 'false',
FOREIGN KEY(userId) REFERENCES Users(userId) ON DELETE CASCADE,
CONSTRAINT Unique_BookedTicketId UNIQUE (bookedTicketId)
);

CREATE TABLE BookedTicket(
id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
bookedTicketId VARCHAR(50) NOT NULL,
ticketCode VARCHAR(50),
quantity INT NOT NULL,
FOREIGN KEY (ticketCode) REFERENCES Tickets(ticketCode),
CONSTRAINT Unique_BookedTicketId_TicketCode UNIQUE (bookedTicketId, ticketCode)
);

INSERT INTO Categories (categoryId, categoryName) VALUES
(0, 'Cinema'), 
(1, 'Hotel'), 
(2, 'Transportasi Darat'), 
(3, 'Transportasi Laut');

INSERT INTO Tickets (ticketCode, ticketName, categoryId, price, quota, eventDate) VALUES 
('TD001', 'Bus Jawa-Sumatera', 2, 50000, 80, '2022-03-01'),
('TL001', 'Kapal Ferri Jawa-Sumatera', 3, 50000, 70, '2022-03-01'),
('C001', 'Ironman CGV', 0, 50000, 99, '2022-03-01'),
('H001', 'Ibis Hotel Jakarta 21-23', 1, 50000, 76, '2022-03-01');

INSERT INTO BookedTicket (bookedTicketId, ticketCode, quantity) VALUES
('B001', 'C001', 6),
('B001', 'H001', 4),
('B001', 'TD001', 10);

INSERT INTO Carts (userId, bookedTicketId) VALUES
('91E22812-0390-49A2-A43D-C3BDAB499EC7', 'B013'),
('91E22812-0390-49A2-A43D-C3BDAB499EC7', 'B007'),
('91E22812-0390-49A2-A43D-C3BDAB499EC7', 'B010'),
('CAF7B306-2773-4282-B8DD-0B799B5E0EC6', 'B009'),
('CAF7B306-2773-4282-B8DD-0B799B5E0EC6', 'B004'),
('0BFC34B3-5ADF-4BF6-AFF5-F13C099668ED', 'B012'),
('0BFC34B3-5ADF-4BF6-AFF5-F13C099668ED', 'B011'),
('0BFC34B3-5ADF-4BF6-AFF5-F13C099668ED', 'B008'),
('0BFC34B3-5ADF-4BF6-AFF5-F13C099668ED', 'B006'),
('0BFC34B3-5ADF-4BF6-AFF5-F13C099668ED', 'B005'),
('0BFC34B3-5ADF-4BF6-AFF5-F13C099668ED', 'B003')